<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
<textarea id="source">

# Make Cool Things Quickly 
## with ASP.Net MVC and ReactJs.Net
.small[
Presented by Edward Delaporte and Zach Carrington 

at [University of Illinois WebCon](http://webcon.illinois.edu/) on April 28, 2016.
]

# This presentation is still under contruction.


---

# Why this presentation, why today?

- Microsoft Recently open sourced much of ASP.Net
- React.Js was the new hot thing last year.

???

--- 

# Terminology

- [ASP.Net](https://github.com/aspnet)
- Model View Controller
- React.js
- ReactJs.Net

???

# About ASP
- Server side
- ASP is for Active Server Pages
- ASP code is typically C# or Visual Basic.Net
- ASP is a Microsoft Technology
- ASP was first released in 1996 - Turns 20 in December.
       (Context: Perl - 1987, Python - 1994, PHP - 1994, Ruby - 1996, Java - 1996, C# and ASP.Net 2002)
- C# is C++ that looks and tastes like Java
- ASP.Net is Microsoft's Open Source 
- Provides package management with NuGet
- NuGet is like Bower or NPM

# About MVC
- Model View Controller
- Sometimes MVVC (Model ViewModel View Controller)

# About React.js
- Client side
- Works with any server side technology
- ReactJs.Net is nice NuGet package for ASP.Net

- Minimal lines of example code for a working web application in ASP.Net MVC with React.js
- Answers for each bit: What do I recommend? Why?

---


# Overview
- Cool stuff that comes with MVC
    - Clean static URLs with MapMvcAttributeRoutes
    - Fast forms and tables with Razor and ViewModels.
    - Refresh client view using AJAX to fetch HTML from server side partials.
        - Want to spend some time on this vs React.js, Pro/Con list.
- Cool stuff that comes with React.js
    - Client side rendering with JSX.
    - JavaScript event based updates.
- Cool stuff that comes with React.js.Net
    - React Bundling
    - Server side rendering of JSX
- Example Code
- Things we did not have time to cover.
    (I plan to add web URLs to resources for each...)
    - NuGet
    - Linq
    - Web.config transforms

# Example GET
- GET diagram
- Raw GET request
- RouteConfig.cs
- Controller.cs
- Razor Table from ViewModel

# Example POST 
- POST diagram
- Raw POST request
- Razor Form from ViewModel
- jQuery POST
- Controller.cs

# Other stuff...
- Razor Form from ViewModel
- Submit Razor Form with JavaScript
- Bundling JavaScript
- React Bundle

???
- Visit http://edward.delaporte.us/WebCon2016.html
- Press P to see my notes.
- Or just view the source.

---

# About Microsoft MVC
    
- MVC is Model View Controller
- [MVC is Open Source](https://github.com/aspnet/Mvc/blob/dev/LICENSE.txt)
- MVC is for C#
- [Microsoft does a lot of Open Source](https://github.com/aspnet)
- [Start here...](https://github.com/aspnet/home)?

???

My relationship with Microsoft
- Basic was my first language.
- Visual Basic is where I learned to love programming.
- Visual Basic 4,5,6 and .Net kick-started my career.
- Microsoft ASP felt like a trap. Too closed. Too limiting.
- Spent 8 years doing Linux LAMP development.
- Spent 9 months doing MVC.


--- 


# Lessons

- "Cool URIs don't change." (Tim Berner's Lee, _Weaving the Web_, 1999)
- Render (most) HTML server side.

???

- URL = URI
- People like to bookmark things.
- URL should reflect purpose.
- New thing? New purpose? New URL.
- Redirects are a thing. Use them.
- Online article: [W3.org Style Guide - Cool URIs don't change](https://www.w3.org/Provider/Style/URI.html)

---

# Examples
- RouteConfig.cs

---
# JavaScript Bundling

```CSharp
public static void RegisterBundles(BundleCollection bundles) {
    bundles.Add(new ScriptBundle("~/bundles/jquery").Include(
        "~/Scripts/jquery-{version}.js",
        "~/Scripts/jquery-ui-{version}.js"));
}
```

???

Notice
- JavaScript Bundles are minified when the debug flag is removed from web.config.
    - There are many nice ways to remove debug from web.config during your publish step.
- Bundle has no extension

Tips
- Use more than one bundle. 
- Organize your bundles by types of pages you want to serve them on.
- User authorization level (public, registered, admin) is a good starting point.

---

# GET Request

```
    Request URL: https://example.com/Payments/Single
    Request Method:GET
    Status Code:200 OK
    Remote Address:10.55.36.184:8080
```

???
- Reminder / Context
- Plain Text
- Returned HTML and status code 200 OK
- Payments/Single

---


# RouteConfig.cs

The MVC template comes with a 'RouteConfig.cs' like this:
.small[
```CSharp
public class RouteConfig {
    public static void RegisterRoutes(RouteCollection routes) {

        routes.MapRoute(
            name: "Default",
            url: "{controller}/{action}/{id}",
        );

    }
}
```
]

***

.small[
```CSharp
public class PaymentsController : Controller {
    [HttpGet]
    public ActionResult Single() {
        /// ... Omitted ...
    }
}
```
]

???

- URLS are determined by controller class names.
- Great URLs never change.
- Great code changes often.
- Controller class names should not be tied to routes.

---

# RouteConfig.cs

Use this instead:
.small[
```CSharp
public class RouteConfig {
    public static void RegisterRoutes(RouteCollection routes) {

        routes.MapMvcAttributeRoutes();

    }
}
```
]

***
.small[
```CSharp
public class SensibleNameController : Controller {
    [HttpGet]
    [Route("Payments/Single")]
    public ActionResult SensibleName() {
        /// ... Omitted ...
    }
}

```
]
???

- Change controller name without changing URL.
- Better! - Change URL without renaming controller.
- Bonus - Keep your sanity by keeping your routes next to your controllers.

---

# Trivial ViewModel

```CSharp
namespace RateCompareWeb.ViewModels {
    public class RateViewModel {
        public string Provider { get; set; }
        public decimal? Rate { get; set; }
        public decimal EstimatedValue { get; set; }
        public decimal OurAdvantage { get; set; }
    }
}
 ``` 

???

- Just a class object with some attributes
- Sometimes use separate ViewModels for Add/Edit/List
- Fields may be input/output or calculated

---

# Typical ViewModel

```CSharp
namespace RateCompareWeb.ViewModels {
    public class RateViewModel {
        public string Provider { get; set; }

        [Display(Name = "Rate")]
        public decimal? RateAPY { get; set; }

        [Display(Name = "Estimated Value")]
        [DataType(DataType.Currency)]
        [DisplayFormat(DataFormatString = "{0:C}", ApplyFormatInEditMode = true)]
        public decimal EstimatedValue { get; set; }

        [Display(Name = "Our Advantage")]
        [DataType(DataType.Currency)]
        [DisplayFormat(DataFormatString = "{0:C}", ApplyFormatInEditMode = true)]
        public decimal OurAdvantage { get; set; }
    }
}
 ``` 

???

- Attributes customize display (label and data format)
- Attributes apply to all generated views (including add/edit/list)
- Other Attributes (Not Shown) add server or client validation

---

# Typical ViewModel 

![Rate Table Parial](static/img/webcon2016/ratepartial.png)

???
- Display Attributes cause labels.

---

# Generate a List Partial

MVC can generate a decent list table from a ViewModel.
![Rate Table Parial](static/img/webcon2016/addview.png)

---

# Generate a List Partial
![Rate Table Parial](static/img/webcon2016/addListViewModelPartial.png)

---

# _PartialTable.cshtml

.small[
```CSharp

@model IEnumerable<RateCompareWeb.ViewModels.RateViewModel>
@{
    Layout = null;
}

<table id="rateTable" class="table table-condensed">
    <tr> 
        <th> @Html.DisplayNameFor(model => model.Provider) </th>
        ... More headers ...
    </tr>

    @foreach (var item in Model) {
    <tr class="@( item.IsOurRate ? " our_rate":"")">
        <td> @Html.DisplayFor(modelItem => item.Provider) </td>
        ... More Row Data ...
    </tr>
    }
</table>

```
]

???

- This is great. We love it.
- Layout = null tells Razor not to add header/footer

---

# _PartialTable.cshtml

![Rate Table Parial](static/img/webcon2016/ratepartial.png)

???

- We added CSS for Bold first row.

---

# Include _PartialTable.cshtml in another page.

Assuming the ratepartial is served at /Home/_RateTable, we can embed it in another page with:
```Razor
<div id="rateList">
    @Html.RenderAction("_RateTable", "Home")
</div>
```
And then refresh it on the client side later with:
```JavaScript
$.ajax({
    url: "/Home/_RateTable"
    method: "GET",
    contentType: 'application/json',
    success: function (data, status, xhr) {
        $("#rateList").html(data);
    }
});
```

???

- id allows jQuery to find it.
- First part does the server side render.
- Second part allows client side updates without reloading the entire page.

---

# Razor Edit Partial

![Rate Edit Form Parital](static/img/webcon2016/addEditViewModelPartial.png)

???

- TODO: Capture a screenshot of the form while on the work network.
- TODO: Capture the generated HTML while on work network.

---

# Razor Edit Partial

```CSharp
@model RateCompareWeb.ViewModels.RateViewModel


@using (Html.BeginForm())
{
@Html.AntiForgeryToken()

<div class="form-horizontal">
  <h4>RateViewModel</h4>
  <hr />
  @Html.ValidationSummary(true, "", new { @class = "text-danger" })
      @Html.LabelFor(model => model.Rate, htmlAttributes: new { @class = "control-label col-md-2" })
      <div class="col-md-10">
          @Html.EditorFor(model => model.Rate, new { htmlAttributes = new { @class = "form-control" } })
          @Html.ValidationMessageFor(model => model.Rate, "", new { @class = "text-danger" })
      </div>
      <!-- ... More fields ... -->
      <div class="col-md-offset-2 col-md-10">
          <input type="submit" value="Save" class="btn btn-default" />
      </div>
</div>
}

<div> @Html.ActionLink("Back to List", "Index") </div>
```

???
    - Same basic steps to generate an HTML form and post it.
    - When you generate a form from a ViewModel, Microsoft Unobtrusive Validation (Open Source JavaScript library for client side validation) is included by default.
    - You may want to use AJAX to POST the form. You can. It works fine.

---

# Razor Edit Partial

![Edit Form Parital](static/img/webcon2016/editrate.png)

---

# Razor Edit Partial HTML

```HTML
  <form action="/" method="post" novalidate="novalidate">
  <input name="__RequestVerificationToken" type="hidden" value="TLeX43jnhexgznkhND0hD8aPJPfMTKomWnp1juSDchb6AFp66AuULNMlFJKTsOovQhvDPA2pErjjh-aAIcAWznX1MVnNP-06Dx5MX6gsdno1">    <div class="form-horizontal">
  <h4>Add a Rate</h4>
  <hr>
  <!-- ... More fields ... -->
  <div class="form-group">
      <label class="control-label col-md-2" for="Rate">APY</label>
      <div class="col-md-10">
          <input class="form-control text-box single-line input-validation-error" data-val="true" data-val-number="The field APY must be a number." id="Rate" name="Rate" type="text" value="">
          <span class="text-danger field-validation-error" data-valmsg-for="Rate" data-valmsg-replace="true"><span for="Rate" class="">The field APY must be a number.</span></span>
      </div>
  </div>
      <div class="form-group">
          <div class="col-md-offset-2 col-md-10">
              <input type="submit" value="Save" class="btn btn-default">
          </div>
      </div>
  </div>
  </form>
  <script src="/Scripts/jquery-1.10.2.js"></script>
  <script src="/Scripts/jquery.validate.js"></script>
  <script src="/Scripts/jquery.validate.unobtrusive.js"></script>
```

???

Quick Tour
- Razor creates HTML and JavaScript
- CSRF Token
- Title (Not Magic)
- Form groups contain input box and hidden validation message.
- Lots of data- markup.
- Activate some JavaScript.
- If you can write these data- attributes, Unobtrusive Validation with work with any server side technology (Django, Java, Ruby on Rails, Perl, PHP)
- You can write these data- attributes.

HIGHLIGHT THE UNOBTRUSIVE BEFORE SWITCHING SLIDES.

---

# Unobtrusive Validation Up Close

```HTML
<input class="form-control text-box single-line input-validation-error" 
       data-val="true" 
       data-val-number="The field APY must be a number." 
       id="Rate" 
       name="Rate" 
       type="text" 
       value="">
<span class="text-danger field-validation-error" 
      data-valmsg-for="Rate" 
      data-valmsg-replace="true">
    <span for="Rate" 
          class="">The field APY must be a number.</span>
</span>
```

???

- Unobtrusive Validaiton is Declarative
- JS library reads the data- attributes, and binds itself to the JS events (change, click, submit)

HOW DID RAZOR KNOW TO ADD THIS VALIDATION?

---

# Validation Attribute

```CSharp
public class PaymentViewModel {
    [Display(Name = "Payment Amount")]
    [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString = "{0:F2}")]
    [Required(ErrorMessage = "Please supply a {0}.")]
    [DataType(DataType.Currency)]
    public decimal Amount { get; set; }
    // ...
}
```

???
- Validation Attribute examples
- Required attribute
- Data type
- Client and server side validation is applied.
- Most are server side, some are client side, some both.

---

# Microsoft Unobtrusive Validation
Is:
- JavaScript
- [Open Source](https://github.com/aspnet/jquery-ajax-unobtrusive/blob/master/LICENSE.txt)
- [On GitHub](https://github.com/aspnet/jquery-ajax-unobtrusive)
- Useful without ASP.Net or Razor
- Declarative, like HTML5

???
- Razor will generate the markup and include the .js reference for you.
- No server side needed
- Apache 2 License
- Like HTML5 - declares desired outcome, rather than steps.
- Try it with Django, Rails, WordPress, Drupal or Node.js
- Available in NuGet and Bower

---
# Microsoft Unobtrusive Validation

```HTML
<input id="ZipCode" name="ZipCode" type="text" value="" maxlength="10"
       data-val="true" 
       data-val-required="A Postal Code is required." 
       data-val-length="A 5 or 10 digit Postal Code is required." 
       data-val-length-max="10" 
       data-val-length-min="5" 
       data-val-regex="The Postal Code is not formatted properly." 
       data-val-regex-pattern="^\d{5}(-?(\d{4}))?$" 
       >
```

???
- Razor can generate data-val-* or you can write it.
- Notice that we have three built-in validators here:
    - required, length, regex

---
# Microsoft Unobtrusive Validation - jQuery Validators
[JQuery Validation](https://github.com/jzaefferer/jquery-validation/) Example
```JavaScript
$.validator.addMethod("validatezipcode",
    function (value, element, param) {
        if (!(new RegExp(/^\d{5}(-?\d{4})?$/)).test(value))
        {
            return false;
        }
        return true;
    }
);
jQuery.validator.unobtrusive.adapters.addBool("validatezipcode");
```

```HTML
<input id="search_zip" 
    data-val="true"
    data-val-validatezipcode="Enter 5 or 9 digits of the Postal Code." 
/>
```
???
- Unobtrusive validators are jQuery validation validators
- $.validator.addMethod
- jQuery.validator.unobtrusive.adapters.addBool("validatezipcode");


---

# Submit Form with AJAX

```JavaScript
$("#editForm").on("submit", function (event) {
// Prevent HTML POST
if(event) event.preventDefault();
// Get values from form
fields = {};
$("#editFormId").find("input[type=text],input[type=hidden]").map(function (id, item) {
fields[item.id] = item.value;
});
// ... Do clever user-friendly things here...
// Submit AJAX POST
$.post("api/thing/", fields, function ( post_response, status ) {
$("#result").html(post_response);
});
});
````

???
- Bind to JavaScript submit event - captures submit button, Enter key, other JavaScript posting the form.
- Prevent page reload.
- Test in Firefox - it works, but it can be sensitive.
- jQuery .find to find fields.
- jQuery .map to update dictionary for each field.
- jQuery .post to submit the form.
- jQuery .html to paste the response HTML right into our output status field.
- Whole update without a page reload.

---
# JSX Example

```HTML
<h2>Do These Today</h2>
<div id='todayActions' />
```
```JS
React.render(
<ActionList title="Today's Actions" api="api/actions/today" />
,document.getElementById('ActionList')
);
```

???

- ActionList.setState calls ActionList.render.
- Multiple calls to setState will render only once.

---

# JSX Example
```JSX
var ActionList = React.createClass({
getInitialState: function() {
return {actions: []};
},
refresh: function() {
$.get(this.props.url, function (data) {
this.setState(data);
}.bind(this));
}.bind(this),
render: function()
{
actions = this.state.actions.map(function (item) {
return (
<Action ref_parent={this.refresh} id={item.id} key={item.id} data={item} />
);
}.bind(this));
return (
<table className="table">
  <thead>
  <th>{this.props.title}</th>
  </thead>
  <tbody>
      {actions}
  </tbody>
</table>
);
}
});
```

???
Cool stuff
- React components can be Composed of other React components.
- props are set in the HTML attributes
- state is set at runtime
Weird stuff
- Use className instead of class
- .bind(this) to call setState on the outer object.
- ReactJS.Net will call render and getInitialState sever side.
- Keep render and getInitialState as empty as you can.
---

# Alternative to JSX 
Reload the partial with JQuery. 
```JavaScript
$.get("/PropertyManager/_PropertyList", function (html) {
    $("#PropertyList").html(html);
}
```

??? 
- Rendering stays server side.
- Still avoids page reload.
- Still works with Single Page App
- Eliminates the need to alternate between Razor and JSX for form layout.
- No surprises during Server side pre-render, as with JSX.
- Benefits fully from ViewModel Attributes and ViewBag

---

???
More misc notes:
# ViewModel.cs
# View.cs
# _PartialView.cs
# Scripts/UserExperience.js
???
- User experience is important.
- User experience belongs as close to the user as possible, so it goes in the JavaScript.
- Think of Razor View as Initial View.
- JavaScript takes over.
- But! Getting it right on the first try still has value.
- JavaScript increases accessibility, by improving user experience.
- JavaScript is no longer a significant source of vulnerability.
- Tell your paranoid friends they can turn it back on.
- Tell them to update their browser first.

# ReactComponent.jsx

Maybe add a link to further reading about Entity Framework and Linq on last page...
Maybe talk briefly about NuGet and have a screenshot or two...

</textarea>
    <!--<script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">-->
    <script src="static/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
